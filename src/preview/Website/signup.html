<!DOCTYPE html>
<html lang="pl">

    <head>
        <meta charset="UTF-8">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <link rel="icon" type="image/png" href="../../assets/icons/webpageicon.png">

        <title>
            Signup | Chmura Preview
        </title>

        <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet"
            integrity="sha384-T3c6CoIi6uLrA9TneNEoa7RxnatzjcDSCmG1MXxSR1GAsXEV/Dwwykc2MPK8M2HN" crossorigin="anonymous">
        <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.1/font/bootstrap-icons.css">
        <link rel="stylesheet" href="../../assets/styles/Main.css">
    </head>

    <body class="app-light-theme">
        <div class="app-container">
            <form id="auth" class="needs-validation position-absolute top-50 start-50 translate-middle" novalidate>
                <input type="hidden" name="_csrf" value="<%= csrfToken %>">
                <h2 class="text-center">Zarejestruj się</h2>
                <h3 id="message" class="text-center fs-6"></h3>
                <div class="form-group mb-2">
                    <label for="email">Email adres <strong class="text-danger">*</strong></label>
                    <input type="email" autocomplete="username" class="form-control" id="email"
                        aria-describedby="emailHelp" placeholder="Wpisz mail" name="email" required>
                    <div class="invalid-feedback">
                        Prosze wpisać maila!
                    </div>
                    <small id="emailHelp" class="form-text text-muted">Nie podamy Twojego adresu e-mail nikomu
                        innemu.</small>
                    </br>
                </div>
                <div class="form-group mb-2">
                    <label for="password1">Hasło <strong class="text-danger">*</strong></label>
                    <input type="password" autocomplete="new-password" class="form-control" id="password1"
                        placeholder="Hasło" name="password1" maxlength="40" minlength="5" required>
                    <div class="invalid-feedback">
                        Prosze wpisać hasło!
                    </div>
                </div>
                <div class="form-group mb-2">
                    <label for="password2">Powtórz hasło <strong class="text-danger">*</strong></label>
                    <input type="password" autocomplete="new-password" class="form-control" id="password2"
                        placeholder="Hasło" name="password2" maxlength="40" minlength="5" required>
                    <div class="invalid-feedback">
                        Prosze powtórzyć hasło!
                    </div>
                </div>
                <a href="/login" class="text-muted">Masz już konto? Zaloguj się!</a>
                <br>
                <button type="submit" class="btn btn-primary mt-3">Zarejestruj</button>
            </form>
        </div>
    </body>

    <script src="javascript/Messages.js"></script>
    <script src="javascript/Validate.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"
        integrity="sha384-C6RzsynM9kWDrMNeT87bh95OGNyZPhcTNXj1NW7RuBCsyN/o0jlpcV8Qyq46cDfL"
        crossorigin="anonymous"></script>
    <script>
        function checkRedirect() {
            const emailCookie = document.cookie.split('; ').find(row => row.startsWith('email='));
            if (emailCookie && emailCookie.split('=')[1]) {
                window.location.href = '/';
            }
        }

        function signup() {
            const email = document.getElementById('email').value;
            const password1 = document.getElementById('password1').value;
            const password2 = document.getElementById('password2').value;

            if (!email || !password1 || !password2) {
                document.getElementById('message').innerText = 'Wprowadź email i hasła.';
                return;
            }

            if (password1 !== password2) {
                document.getElementById('message').innerText = 'Hasła nie pasują do siebie.';
                return;
            }

            document.cookie = `email=${email}; max-age=86400`;

            window.location.href = '/';
        }

        document.addEventListener('DOMContentLoaded', function () {
            checkRedirect();
        });

        document.getElementById('auth').addEventListener('submit', function (event) {
            event.preventDefault();
            signup();
        });
    </script>


</html>